<!DOCTYPE html>
<html>
<head>
    <title>OpenClover 4.2 : Deploying Instrumented Jars</title>
    <link rel="stylesheet" href="../../../resources/css/bootstrap.min.css" type="text/css"/>
    <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
</head>

<body class="theme-default aui-theme-default">
<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar"
                    aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="../../../index"><img src="../../../resources/img/openclover_logo_white_40pt_alpha_with_icon.png" alt="OpenClover"/></a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
                <li><a href="../../../index">Overview</a></li>
                <li><a href="../../../features">Features</a></li>
                <li><a href="../../../downloads">Downloads</a></li>
                <li class="active"><a href="../../../documentation">Documentation</a></li>
                <li><a href="../../../support">Support</a></li>
                <li><a href="../../../blog">Blog</a></li>
                <!--<li><a href="../../../faq">FAQ</a></li>-->
                <li><a href="../../../about-us">About us</a></li>
            </ul>
        </div>
    </div>
</nav>

<div id="page" class="container">
    <div id="main" class="aui-page-panel">
        <div id="main-header">
            <div id="breadcrumb-section">
                <ol id="breadcrumbs">
                    <li class="first">
                        <span><a href="index.html">OpenClover 4.2</a></span>
                    </li>
                    <li>
                        <span><a href="index--clover-documentation-home.html">Clover Documentation Home</a></span>
                    </li>
                    <li>
                        <span><a href="faq--openclover.html">Clover FAQ</a></span>
                    </li>
                    <li>
                        <span>Maven Plugin FAQ</span>
                    </li>
                </ol>
            </div>
            <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            Deploying Instrumented Jars
                        </span>
            </h1>
        </div>

        <div id="content" class="view">

            <div id="main-content" class="wiki-content group">
                <p>When the <code>deploy</code> target is run, the Clover lifecycle doesn't deploy its artifacts. There
                    is a <a  href="http://developer.atlassian.com/jira/browse/CLMVN-9"
                            rel="nofollow">JIRA issue CLMVN-9</a> open for this limitation.</p>

                <p>As a work around, you can use the <code>build-helper-maven-plugin</code> as follows:</p>
                <ul>
                    <li>The general idea is to attach the instrumented jar (the primary artifact of the clover-plugin
                        forked lifecycle) as a secondary artifact to the original lifecycle by means of the
                        build-helper-maven-plugin. A normal 'mvn deploy' (which targets the original lifecycle) will
                        then lead to the desired deployment of the instrumented jar.
                    </li>
                    <li>The complicated thing in the attachment of the forked lifecycle's primary artifact (the
                        instrumented jar, that is) to the original lifecycle is, that the forked lifecycle will inherit
                        the whole original lifecycle's configuration, including the introduced attachment. Thus, the
                        forked lifecycle will have the same artifact (its primary artifact) both as primary and as a
                        secondary artifact. Maven will enforce distinct names for the two, leading to necessary
                        classifier substitution in the build-helper configuration:
                    </li>
                </ul>


                <div class="code panel pdl" style="border-width: 1px;">
                    <div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence"
     data-theme="Confluence">
&lt;plugin&gt;
  &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;
  &lt;artifactId&gt;build-helper-maven-plugin&lt;/artifactId&gt;
    &lt;executions&gt;
      &lt;execution&gt;
        &lt;id&gt;attach-instrumented-jar&lt;/id&gt;
        &lt;phase&gt;verify&lt;/phase&gt;
        &lt;goals&gt;
          &lt;goal&gt;attach-artifact&lt;/goal&gt;
        &lt;/goals&gt;
        &lt;configuration&gt;
          &lt;artifacts&gt;
            &lt;artifact&gt;
              &lt;file&gt;
                ${basedir}/target/clover/${project.artifactId}-${project.version}-clover.jar
              &lt;/file&gt;
              &lt;type&gt;jar&lt;/type&gt;
              &lt;classifier&gt;clovered&lt;/classifier&gt;
            &lt;/artifact&gt;
          &lt;/artifacts&gt;
        &lt;/configuration&gt;
      &lt;/execution&gt;
  &lt;/executions&gt;
&lt;/plugin&gt;
</pre>
                    </div>
                </div>
                <p>A subsequent 'mvn deploy' will lead to a deployment of the instrumented jar, the 'Clovered' version
                    as a secondary artifact along with the non-instrumented (original lifecycle's) primary artifact.</p>
            </div>


        </div>
    </div>
</div>
<div class="container">
    <footer>
        <p class="small text-muted">
            &copy; This document is a derivative work of
            <a href="https://confluence.atlassian.com/clover">Clover documentation</a>
            created by <a href="https://www.atlassian.com">Atlassian</a> and licensed under
            <a href="https://creativecommons.org/licenses/by/2.5/au/legalcode">CC 2.5 Australia</a>.
            Modifications by Marek Parfianowicz, under
            <a href="https://creativecommons.org/licenses/by/2.5/au/legalcode">CC 2.5 Australia</a>.
        </p>
    </footer>
</div>
</body>
</html>
